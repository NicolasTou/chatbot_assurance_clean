efrom langchain_community.vectorstores import FAISS
from langchain_openai import OpenAIEmbeddings
from langchain.chains import RetrievalQA
from langchain_openai import ChatOpenAI
from langchain_community.document_loaders import PyPDFLoader
import os

# Assure-toi que ta clé API OpenAI est bien définie dans l'environnement
# Exemple : export OPENAI_API_KEY=sk-...

# Chargement des documents
loader = PyPDFLoader("Conditions_generales.pdf")
docs = loader.load()

# Création des embeddings et de l'index FAISS
embeddings = OpenAIEmbeddings()
db = FAISS.from_documents(docs, embeddings)

# Création de la chaîne QA
retriever = db.as_retriever()
llm = ChatOpenAI(temperature=0)
qa_chain = RetrievalQA.from_chain_type(llm=llm, retriever=retriever)

# Fonction appelée depuis app.py
def ask_question(query):
    return qa_chain.invoke({"query": query})["result"]

# Exécution console si le fichier est lancé directement
if __name__ == "__main__":
    while True:
        query = input("Posez votre question (ou 'exit') : ")
        if query.lower() == "exit":
            print("Fin du programme.")
            break
        result = ask_question(query)
        print(f"\nRéponse : {result}\n")
